<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1E3A8A">
    <title>Student Data Master v4.3</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

    <style>
        :root { --primary: #1E3A8A; --secondary: #10B981; --bg: #DBEAFE; --error: #EF4444; --warning: #F59E0B; --white: #FFFFFF; }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg); margin: 0; padding: 10px; }
        header { width: 100%; max-width: 600px; background: var(--primary); color: white; padding: 15px; border-radius: 12px; text-align: center; margin: 0 auto 15px auto; }
        .card { background: var(--white); width: 100%; max-width: 600px; border-radius: 15px; padding: 20px; border: 1px solid #BFDBFE; margin: 0 auto 20px auto; }
        
        /* Form Styles */
        .section-title { color: var(--primary); font-weight: 800; border-bottom: 2px solid #E5E7EB; margin: 25px 0 12px 0; padding-bottom: 5px; text-transform: uppercase; font-size: 0.9rem; display: flex; align-items: center; gap: 8px; }
        .field-group { margin-bottom: 12px; }
        label { display: block; font-size: 0.7rem; font-weight: 700; margin-bottom: 4px; color: #4B5563; }
        input, select, textarea { width: 100%; min-height: 42px; padding: 8px; border: 1.5px solid #D1D5DB; border-radius: 8px; font-size: 1rem; background: #F9FAFB; }
        .up { text-transform: uppercase; }

        .btn-stack { display: flex; flex-direction: column; gap: 10px; margin-top: 25px; }
        button { width: 100%; min-height: 50px; border: none; border-radius: 10px; color: white; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-add { background: var(--secondary); }
        .btn-search { background: var(--primary); }
        .btn-update { background: var(--warning); display: none; } 
        .btn-clear { background: var(--error); margin-top: 10px; border: 2px solid #991b1b; }

        /* Search Modal */
        #searchModal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 1000; padding: 15px; justify-content: center; align-items: flex-start; overflow-y: auto; }
        .modal-content { background: white; border-radius: 15px; padding: 20px; width: 100%; max-width: 500px; margin-top: 20px; }
        .search-item { background: #f1f5f9; padding: 12px; border-radius: 8px; margin-bottom: 10px; border-left: 5px solid var(--primary); }
        .btn-sm { flex: 1; min-height: 35px; font-size: 0.8rem; border-radius: 5px; color: white; border: none; margin-top: 5px;}

        /* Version Label */
        .version-tag { text-align: center; font-size: 0.7rem; color: #64748b; margin-top: 20px; padding-bottom: 20px; }

        /* PRINT SETTINGS - MANDATORY A4 3-COLUMN */
        #printArea { display: none; }
        @media print {
            @page { size: A4 portrait; margin: 8mm; }
            html, body { background: #fff !important; }
            #main-content, #searchModal, .version-tag, header { display: none !important; }
            #printArea { display: block !important; position: absolute; top: 0; left: 0; width: 100%; }
            .print-header { display: flex; justify-content: space-between; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 10px; }
            .photo-box { width: 30mm; height: 35mm; border: 1.5px solid #000; display: flex; align-items: center; justify-content: center; text-align: center; font-size: 8pt; font-weight: bold; }
            .print-grid { display: grid !important; grid-template-columns: repeat(3, 1fr) !important; gap: 4px !important; }
            .print-cell { border: 0.2px solid #ddd; padding: 3px; height: 38px; }
            .print-label { font-weight: bold; font-size: 6.5pt; text-transform: uppercase; color: #333; display: block; }
            .print-value { font-size: 8.5pt; color: #000; font-weight: 500; }
            .footer-sign { margin-top: 40px; display: flex; justify-content: space-between; font-weight: bold; font-size: 10pt; border-top: 1px dashed #ccc; padding-top: 20px; }
        }

        #toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); padding: 12px 20px; border-radius: 25px; color: white; display: none; z-index: 10001; }
    </style>
</head>
<body>

    <div id="main-content">
        <header>
            <i class="fas fa-university fa-2x"></i>
            <h2 style="margin:5px 0;">Student Portal</h2>
        </header>

        <div class="card">
            <form id="studentForm">
                <input type="hidden" id="editID">

                <div class="section-title"><i class="fas fa-book"></i> Academic Details</div>
                <div class="field-group"><label>CLASS *</label><select id="CLASS" required><option value="">Select</option><option>IX</option><option>X</option><option>XI</option><option>XII</option></select></div>
                <div class="field-group"><label>DIVISION *</label><select id="DIVISION" required><option value="">Select</option><option>A</option><option>B</option><option>C</option><option>D</option></select></div>
                <div class="field-group"><label>ROLL NO. *</label><input type="number" id="ROLL_NO" required></div>
                <div class="field-group"><label>GR NO. *</label><input type="number" id="GR_NO" required></div>
                <div class="field-group"><label>STUDENT NAME (L.C.) *</label><input type="text" id="STUDENT_NAME" class="up" required></div>
                <div class="field-group"><label>DATE OF ADMISSION *</label><input type="date" id="DOA" required></div>
                <div class="field-group"><label>PREV. SCHOOL NAME</label><input type="text" id="PREV_SCHOOL" class="up"></div>

                <div class="section-title"><i class="fas fa-user"></i> Personal Details</div>
                <div class="field-group"><label>GENDER *</label><select id="GENDER" required><option value="">Select</option><option>Male</option><option>Female</option></select></div>
                <div class="field-group"><label>DATE OF BIRTH (L.C.) *</label><input type="date" id="DOB_LC" required></div>
                <div class="field-group"><label>PLACE OF BIRTH</label><input type="text" id="POB" class="up"></div>
                <div class="field-group"><label>CASTE</label><input type="text" id="CASTE" class="up"></div>
                <div class="field-group"><label>AADHAR NO. *</label><input type="text" id="AADHAR_NO" maxlength="12" required></div>
                <div class="field-group"><label>NAME ON AADHAR</label><input type="text" id="NAME_AADHAR" class="up"></div>
                <div class="field-group"><label>DOB ON AADHAR</label><input type="date" id="DOB_AADHAR"></div>

                <div class="section-title"><i class="fas fa-phone"></i> Contact Details</div>
                <div class="field-group"><label>FATHER NAME</label><input type="text" id="FATHER_NAME" class="up"></div>
                <div class="field-group"><label>MOTHER NAME</label><input type="text" id="MOTHER_NAME" class="up"></div>
                <div class="field-group"><label>MOBILE 1 *</label><input type="tel" id="MOBILE_1" maxlength="10" required></div>
                <div class="field-group"><label>MOBILE 2</label><input type="tel" id="MOBILE_2" maxlength="10"></div>
                <div class="field-group"><label>EMAIL ID</label><input type="email" id="EMAIL_ID"></div>
                <div class="field-group"><label>ADDRESS *</label><textarea id="ADDRESS" rows="2" class="up" required></textarea></div>

                <div class="section-title"><i class="fas fa-id-badge"></i> Govt & Bank IDs</div>
                <div class="field-group"><label>BANK ACC NO.</label><input type="text" id="BANK_ACC"></div>
                <div class="field-group"><label>BANK NAME</label><input type="text" id="BANK_NAME" class="up"></div>
                <div class="field-group"><label>IFSC CODE</label><input type="text" id="IFSC" class="up"></div>
                <div class="field-group"><label>PEN NO.</label><input type="text" id="PEN" class="up"></div>
                <div class="field-group"><label>APAAR ID</label><input type="text" id="APAAR" class="up"></div>

                <div class="section-title"><i class="fas fa-heartbeat"></i> Medical & Misc</div>
                <div class="field-group"><label>BLOOD GROUP</label><select id="BLOOD_GROUP"><option value="">Select</option><option>A+</option><option>A-</option><option>B+</option><option>B-</option><option>AB+</option><option>AB-</option><option>O+</option><option>O-</option></select></div>
                <div class="field-group"><label>HEIGHT (CM)</label><input type="number" id="HEIGHT"></div>
                <div class="field-group"><label>WEIGHT (KG)</label><input type="number" id="WEIGHT"></div>
                <div class="field-group"><label>LAST CLASS %</label><input type="number" id="PERCENTAGE" step="0.01"></div>
                <div class="field-group"><label>DISTANCE (KM)</label><input type="number" id="DISTANCE" step="0.1"></div>
                <div class="field-group"><label>HOSTEL?</label><select id="HOSTEL"><option>No</option><option>Yes</option></select></div>
                <div class="field-group"><label>ORPHAN?</label><select id="ORPHAN"><option>No</option><option>Yes</option></select></div>
                <div class="field-group"><label>APL/BPL</label><select id="APL_BPL"><option>APL</option><option>BPL</option></select></div>
                <div class="field-group"><label>REMARK</label><textarea id="REMARK" rows="1" class="up"></textarea></div>

                <div class="btn-stack">
                    <button type="button" id="saveBtn" class="btn-add" onclick="handleSave()"><i class="fas fa-save"></i> Save Record</button>
                    <button type="button" id="updateBtn" class="btn-update" onclick="handleUpdate()"><i class="fas fa-sync"></i> Update Record</button>
                    <button type="button" class="btn-search" onclick="openSearch()"><i class="fas fa-search"></i> Search / Edit / Delete</button>
                    <button type="button" class="btn-excel" onclick="exportToExcel()" style="background:#065F46"><i class="fas fa-file-excel"></i> Export All to Excel</button>
                    <button type="button" class="btn-clear" onclick="wipeDatabase()"><i class="fas fa-eraser"></i> Wipe All Data</button>
                </div>
            </form>
        </div>
        <div class="version-tag">Build: 2
